# 쇼핑몰별 상품 검색 스크래퍼 서버
# "기획 세트 등록" 페이지에서 사용
services:
  product-search-scraper:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: product-search-scraper-api
    ports:
      - "3987:3000"
    environment:
      - NODE_ENV=production
      - PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD=1
      - PORT=3000
    # IPC 모드 설정 (Chromium 메모리 문제 방지)
    ipc: host
    # 메모리 제한
    mem_limit: 4g
    mem_reservation: 2g
    # CPU 제한
    cpus: '4.0'
    # 재시작 정책
    restart: unless-stopped
    # 로그 설정
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    # 헬스체크
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

