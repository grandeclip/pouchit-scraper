mall: oliveyoung
name: "ì˜¬ë¦¬ë¸Œì˜"
baseUrl: "https://www.oliveyoung.co.kr"
searchUrl: "${baseUrl}/store/search/getSearchMain.do?query=${encodedQuery}"

# ìµœëŒ€ ê²°ê³¼ ìˆ˜ ì œí•œ
maxResults: 5

# ë¸Œë¼ìš°ì € ì„¤ì •
browser:
  headless: true
  args:
    - "--no-sandbox"
    - "--disable-setuid-sandbox"
    - "--disable-dev-shm-usage"
    - "--disable-accelerated-2d-canvas"
    - "--no-first-run"
    - "--no-zygote"
    - "--disable-gpu"
  viewport:
    width: 1920
    height: 1080
  # userAgentëŠ” config/userAgents/userAgents.yamlì—ì„œ ëœë¤ ì„ íƒë¨
  # í• ë‹¹ëœ User-Agents: chrome_mac_simple, chrome_mac_v120, chrome_mac_v131, chrome_win_v120, chrome_win_v131

# ë„¤ë¹„ê²Œì´ì…˜ ìˆœì„œ
navigation:
  steps:
    # 1. í™ˆí˜ì´ì§€ ì ‘ì† (ì„¸ì…˜ ì´ˆê¸°í™”)
    - action: goto
      url: "${baseUrl}"
      waitUntil: domcontentloaded
      timeout: 30000
    - action: wait
      duration: 2000

    # 2. ê²€ìƒ‰ í˜ì´ì§€ ì´ë™
    - action: goto
      url: "${searchUrl}"
      waitUntil: domcontentloaded
      timeout: 30000

    # ğŸ”¥ 3. ê²€ìƒ‰ ê²°ê³¼ ìˆìŒ/ì—†ìŒ Race (ë¹ ë¥¸ ê°ì§€)
    - action: waitForEither
      success:
        - ".cate_prd_list"
        - ".prd_info"
      failure:
        - ".no_result"
        - ".search_no_result"
        - "text=/ê²€ìƒ‰.*ê²°ê³¼.*ì—†/"
        - "text=/ìƒí’ˆ.*ì—†/"
      timeout: 5000
      onFailure: returnEmpty

    # 4. ì¶”ê°€ ëŒ€ê¸° (ë™ì  ì½˜í…ì¸  ë¡œë”©) - ì„±ê³µ ì‹œì—ë§Œ ì‹¤í–‰
    - action: wait
      duration: 3000

# ë°ì´í„° ì¶”ì¶œ ê·œì¹™
extraction:
  type: evaluate
  script: |
    (function() {
      const results = [];
      const MAX_RESULTS = 5; // ìµœëŒ€ 5ê°œê¹Œì§€ë§Œ
      const seenUrls = new Set(); // URL ì¤‘ë³µ ì²´í¬ìš©
      const items = document.querySelectorAll('.prd_info');

      items.forEach((item) => {
        // ìµœëŒ€ ê°œìˆ˜ ì²´í¬
        if (results.length >= MAX_RESULTS) return;
        try {
          // ìƒí’ˆ ë§í¬ ì°¾ê¸°
          const link = item.querySelector('a.prd_thumb, a[href*="goodsNo"]');
          if (!link) return;
          
          const href = link.getAttribute('href');
          if (!href) return;
          
          // goodsNo ì¶”ì¶œ
          const goodsNoMatch = href.match(/goodsNo=([A-Z0-9]+)/);
          if (!goodsNoMatch) return;
          
          const goodsNo = goodsNoMatch[1];
          
          // ë¸Œëœë“œ
          const brandElement = item.querySelector('.tx_brand');
          const brand = brandElement ? brandElement.textContent.trim() : '';
          
          // ìƒí’ˆëª…
          const nameElement = item.querySelector('.tx_name');
          const productName = nameElement ? nameElement.textContent.trim() : '';
          if (!productName) return;
          
          // ì¸ë„¤ì¼
          const imgElement = item.querySelector('.prd_thumb img');
          const thumbnail = imgElement ? imgElement.getAttribute('src') : null;
          
          // íŒë§¤ê°€
          const salePriceElement = item.querySelector('.prd_price .tx_cur .tx_num');
          let salePrice = 0;
          if (salePriceElement) {
            const salePriceText = salePriceElement.textContent.replace(/[^0-9]/g, '');
            salePrice = parseInt(salePriceText, 10) || 0;
          }
          
          // ì›ê°€
          const originalPriceElement = item.querySelector('.prd_price .tx_org .tx_num');
          let originalPrice = null;
          if (originalPriceElement) {
            const originalPriceText = originalPriceElement.textContent.replace(/[^0-9]/g, '');
            const parsedOriginalPrice = parseInt(originalPriceText, 10);
            if (parsedOriginalPrice && parsedOriginalPrice > 0) {
              originalPrice = parsedOriginalPrice;
            }
          }
          
          // ìƒí’ˆ URL ìƒì„±
          const productUrl = 'https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=' + goodsNo;

          // URL ì¤‘ë³µ ì²´í¬ (ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì œê±°í•œ ì •ê·œí™”ëœ URLë¡œ ë¹„êµ)
          const normalizedUrl = productUrl.split('?')[0];
          if (seenUrls.has(normalizedUrl)) {
            console.log('[OliveYoung] ì¤‘ë³µ URL ì œê±°:', normalizedUrl);
            return;
          }
          seenUrls.add(normalizedUrl);

          results.push({
            productId: goodsNo,
            goodsNo: goodsNo,
            brand: brand,
            productName: productName,
            thumbnail: thumbnail,
            salePrice: salePrice,
            originalPrice: originalPrice,
            productUrl: productUrl,
          });
        } catch (error) {
          // ê°œë³„ ìƒí’ˆ íŒŒì‹± ì˜¤ë¥˜ ë¬´ì‹œ
          console.error('ì˜¬ë¦¬ë¸Œì˜ ìƒí’ˆ íŒŒì‹± ì˜¤ë¥˜:', error);
        }
      });
      
      return results;
    })
  fields:
    productId:
      selector: "dummy"
